<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>ğŸ” Check Token</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #000;
            padding: 20px;
            border: 2px solid #00ff00;
        }
        pre {
            background: #1a1a1a;
            padding: 15px;
            border: 1px solid #00ff00;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .error { color: #ff0000; }
        .warning { color: #ffaa00; }
        .success { color: #00ff00; }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 20px;
            margin: 10px 5px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #00aa00;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” TOKEN CHECKER</h1>
        <button onclick="checkToken()">ğŸ”‘ Kiá»ƒm tra Token</button>
        <button onclick="clearAndLogout()">ğŸšª ÄÄƒng xuáº¥t & Clear</button>
        <button onclick="location.href='index.html'">ğŸ  Vá» trang chá»§</button>
        
        <h2>ğŸ“Š Káº¿t quáº£:</h2>
        <pre id="output"></pre>
    </div>

    <script>
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const className = type === 'error' ? 'error' : type === 'warning' ? 'warning' : type === 'success' ? 'success' : '';
            output.innerHTML += `<span class="${className}">${message}</span>\n`;
        }

        function checkToken() {
            document.getElementById('output').innerHTML = '';
            
            log('ğŸ” KIá»‚M TRA TOKEN...', 'info');
            log('='.repeat(60));
            
            const token = localStorage.getItem('token');
            
            if (!token) {
                log('âŒ KHÃ”NG TÃŒM THáº¤Y TOKEN!', 'error');
                log('Báº¡n chÆ°a Ä‘Äƒng nháº­p hoáº·c token Ä‘Ã£ bá»‹ xÃ³a.', 'error');
                return;
            }
            
            log(`âœ… Token tá»“n táº¡i (length: ${token.length})`, 'success');
            log('');
            
            try {
                // Decode JWT
                const parts = token.split('.');
                if (parts.length !== 3) {
                    log('âŒ Token khÃ´ng Ä‘Ãºng Ä‘á»‹nh dáº¡ng JWT!', 'error');
                    return;
                }
                
                const payload = JSON.parse(atob(parts[1]));
                
                log('ğŸ“¦ PAYLOAD:', 'success');
                log(JSON.stringify(payload, null, 2), 'success');
                log('');
                
                log('ğŸ“‹ THÃ”NG TIN CHI TIáº¾T:', 'info');
                log('='.repeat(60));
                log(`ğŸ‘¤ User ID: ${payload.id || 'KHÃ”NG CÃ“'}`, payload.id ? 'success' : 'error');
                log(`ğŸ‘¤ Username: ${payload.username || 'KHÃ”NG CÃ“'}`, payload.username ? 'success' : 'error');
                log(`ğŸ­ Role: ${payload.role || 'KHÃ”NG CÃ“'}`, payload.role ? 'success' : 'error');
                
                // CRITICAL: Check company_id
                if (payload.company_id) {
                    log(`ğŸ¢ Company ID: ${payload.company_id}`, 'success');
                    log('âœ… Token CÃ“ company_id - ÄÃšNG!', 'success');
                } else {
                    log(`ğŸ¢ Company ID: KHÃ”NG CÃ“`, 'error');
                    log('âŒ TOKEN THIáº¾U COMPANY_ID!', 'error');
                    log('', 'error');
                    log('âš ï¸ Cáº¢NH BÃO:', 'warning');
                    log('Token nÃ y khÃ´ng cÃ³ company_id!', 'warning');
                    log('Äiá»u nÃ y cÃ³ nghÄ©a lÃ :', 'warning');
                    log('  - Token Ä‘Æ°á»£c táº¡o trÆ°á»›c khi há»‡ thá»‘ng cÃ³ company_id', 'warning');
                    log('  - Báº¡n sáº½ tháº¥y dá»¯ liá»‡u cá»§a Táº¤T Cáº¢ cÃ´ng ty', 'warning');
                    log('', 'warning');
                    log('ğŸ”§ GIáº¢I PHÃP:', 'error');
                    log('1. Nháº¥n nÃºt "ÄÄƒng xuáº¥t & Clear"', 'error');
                    log('2. ÄÄƒng nháº­p láº¡i', 'error');
                    log('3. Token má»›i sáº½ cÃ³ company_id', 'error');
                }
                
                log('');
                log('â° THá»œI GIAN:', 'info');
                if (payload.iat) {
                    const issuedAt = new Date(payload.iat * 1000);
                    log(`Táº¡o lÃºc: ${issuedAt.toLocaleString('vi-VN')}`, 'info');
                }
                if (payload.exp) {
                    const expiresAt = new Date(payload.exp * 1000);
                    const now = new Date();
                    const isExpired = now > expiresAt;
                    log(`Háº¿t háº¡n: ${expiresAt.toLocaleString('vi-VN')}`, isExpired ? 'error' : 'success');
                    if (isExpired) {
                        log('âŒ TOKEN ÄÃƒ Háº¾T Háº N!', 'error');
                    } else {
                        const remaining = Math.floor((expiresAt - now) / 1000 / 60);
                        log(`â³ CÃ²n láº¡i: ${remaining} phÃºt`, 'success');
                    }
                }
                
            } catch (error) {
                log('âŒ Lá»–I KHI DECODE TOKEN!', 'error');
                log(`Error: ${error.message}`, 'error');
            }
        }

        function clearAndLogout() {
            if (confirm('âš ï¸ Báº N CHáº®C CHáº®N MUá»N ÄÄ‚NG XUáº¤T?\n\nTáº¥t cáº£ dá»¯ liá»‡u session sáº½ bá»‹ xÃ³a.')) {
                localStorage.clear();
                sessionStorage.clear();
                log('âœ… ÄÃ£ xÃ³a táº¥t cáº£ dá»¯ liá»‡u local storage', 'success');
                log('ğŸ”„ Chuyá»ƒn Ä‘áº¿n trang Ä‘Äƒng nháº­p...', 'info');
                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            }
        }

        // Auto check on load
        window.addEventListener('DOMContentLoaded', () => {
            checkToken();
        });
    </script>
</body>
</html>
